<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farmer</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" 
    crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" 
    crossorigin="anonymous"></script>
    <link rel="stylesheet" href="Style.css" />
    <style> 
        body {
            background-image: url("OmaniFarmer.jpg");
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white;
        }
    </style> 
</head>
<body>
    <div class="navbar navbar-expand-lg navbar-tabs">
        <div class="container">
            <a class="navbar-brand text-white" href="index.html">
                <img src="logo.png" alt="Logo" height="30" style="vertical-align:middle; margin-right:6px;">
                <span class="fw-bold align-middle">AIM</span>
            </a>

            <ul class="nav nav-tabs ms-auto">
                <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="About Us.html">About Us</a></li>
                <li class="nav-item"><a class="nav-link active" href="Farmer.html">Farmer</a></li>
                <li class="nav-item"><a class="nav-link" href="Government.html">Government</a></li>
                <li class="nav-item"><a class="nav-link" href="Company.html">Company</a></li>
                <li class="nav-item"><a class="nav-link" href="Researcher.html">Researcher</a></li>
                <li class="nav-item"><a class="nav-link" href="Analytics.html">Analytics</a></li>
                <li class="nav-item"><a class="nav-link" href="calculator.html">Calculator</a></li>
                <li class="nav-item"><a class="nav-link" href="Contact Us.html">Contact Us</a></li>
            </ul>
        </div>
    </div>

    <div class="d-flex justify-content-center align-items-center py-4">
        <h2 class="fw-bold">Farmer Dashboard</h2>
    </div>
    <p style="text-align: center">Monitor your farm's water usage and manage irrigation efficiently</p>

    <div class="container">
        <div class="card p-4 mb-4">
            <h5>"Ù‚Ø§Ù„ ØªØ¹Ø§Ù„Ù‰: "ÙˆÙØ¬ÙØ¹ÙÙ„Ù’Ù†ÙØ§ Ù…ÙÙ†Ù Ø§Ù„Ù’Ù…ÙØ§Ø¡Ù ÙƒÙÙ„ÙÙ‘ Ø´ÙÙŠÙ’Ø¡Ù Ø­ÙÙŠÙÙ‘</h5>
            <p>
                The AIM system helps you track how much water your farm uses daily and weekly.
                You can compare data over time, receive alerts if usage exceeds recommended limits,
                and adopt smarter irrigation practices that save water and reduce costs.
            </p>
        </div>

        <!-- Action Buttons -->
        <div class="text-center mb-5">
            <button class="btn btn-custom2 m-2" onclick="_enterFarmerData()">ğŸ“ Enter Water Usage Data</button>
            <button class="btn btn-custom2 m-2" onclick="_updateFarmDetails()">ğŸ¡ Update Farm Details</button>
            <button class="btn btn-custom2 m-2" onclick="_viewFarmerHistory()">ğŸ“‹ View My History</button>
        </div>

        <!-- Farmer Stats Section - Live Data -->
        <div class="row text-center mb-4">
            <div class="col-md-4 mb-3">
                <div class="card p-3">
                    <h6>Total Water Usage</h6>
                    <p class="fs-4 fw-bold text-success" id="todayWaterUse">0 L</p>
                    <small class="text-muted" id="farmerCount">0 entries</small>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card p-3">
                    <h6>Average Per Farm</h6>
                    <p class="fs-4 fw-bold text-primary" id="weeklyAverage">0 L</p>
                    <small class="text-muted">Per entry average</small>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card p-3">
                    <h6>Alerts Received</h6>
                    <p class="fs-4 fw-bold text-danger" id="farmerAlerts">0</p>
                    <small class="text-muted">Exceeding 300L threshold</small>
                </div>
            </div>
        </div>

        <!-- Recent Entries Table -->
        <div class="card p-4 mb-4">
            <h5 class="text-success fw-bold">ğŸ“Š Recent Water Usage Entries</h5>
            <div class="table-responsive">
                <table class="table table-striped" id="farmerEntriesTable">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Farmer Name</th>
                            <th>Water Usage (L)</th>
                            <th>Farm Size (ha)</th>
                            <th>Date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="farmerTableBody">
                        <tr>
                            <td colspan="6" class="text-center text-muted">No data yet. Click "Enter Water Usage Data" to begin.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Educational Tip -->
        <div class="card p-4">
            <h5>ğŸŒ± Smart Irrigation Tip</h5>
            <p>
                Water your crops early in the morning or late evening to reduce evaporation losses. 
                Use drip irrigation systems for better efficiency and consistent moisture levels.
            </p>
        </div>
    </div>

    <hr>
    <div class="text-white py-4" style="background-color: #1B3C53;">
        <div class="container">
            <p class="mb-2 mb-sm-0">@ 2025 AgriSense - All rights reserved.</p>
        </div>
    </div>

    <script src="samira.js"></script>
    <script>
        // Update farmer dashboard when page loads
        function updateFarmerPage() {
            // Load data from localStorage
            let farmerData = [];
            try {
                const stored = localStorage.getItem('farmerData');
                if (stored) {
                    farmerData = JSON.parse(stored);
                }
            } catch (e) {
                console.error("Error loading farmer data:", e);
            }

            // Update statistics
            if (farmerData.length > 0) {
                let totalWater = farmerData.reduce((sum, f) => sum + f.waterUsage, 0);
                document.getElementById('todayWaterUse').textContent = totalWater.toFixed(2) + ' L';
                
                let avgWater = (totalWater / farmerData.length).toFixed(2);
                document.getElementById('weeklyAverage').textContent = avgWater + ' L';
                
                let alerts = farmerData.filter(f => f.waterUsage > 300).length;
                document.getElementById('farmerAlerts').textContent = alerts;
                
                document.getElementById('farmerCount').textContent = farmerData.length + ' entries';
                
                // Update table
                updateFarmerTable(farmerData);
            } else {
                document.getElementById('todayWaterUse').textContent = '0 L';
                document.getElementById('weeklyAverage').textContent = '0 L';
                document.getElementById('farmerAlerts').textContent = '0';
                document.getElementById('farmerCount').textContent = '0 entries';
            }
        }

        // Update the table with recent entries
        function updateFarmerTable(farmerData) {
            const tbody = document.getElementById('farmerTableBody');
            
            if (farmerData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">No data yet. Click "Enter Water Usage Data" to begin.</td></tr>';
                return;
            }
            
            tbody.innerHTML = '';
            
            // Show last 10 entries
            const recentData = farmerData.slice(-10).reverse();
            
            recentData.forEach((farmer, index) => {
                const row = document.createElement('tr');
                const isExcess = farmer.waterUsage > 300;
                
                row.innerHTML = `
                    <td>${farmerData.length - index}</td>
                    <td>${farmer.name}</td>
                    <td class="${isExcess ? 'text-danger fw-bold' : ''}">${farmer.waterUsage.toFixed(2)}</td>
                    <td>${farmer.farmSize}</td>
                    <td>${farmer.date}</td>
                    <td>${isExcess ? '<span class="badge bg-danger">âš ï¸ High</span>' : '<span class="badge bg-success">âœ“ Normal</span>'}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Run when page loads
        document.addEventListener('DOMContentLoaded', function() {
            updateFarmerPage();
            
            // Auto-refresh every 2 seconds to catch updates
            setInterval(updateFarmerPage, 2000);
        });
    </script>
</body>
</html>
