<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" 
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" 
    crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" 
    crossorigin="anonymous"></script>
    <link rel="stylesheet" href="Style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body id="grade">
<nav class="navbar navbar-expand-lg navbar-dark" style="background-color:#1B3C53; letter-spacing:0;">
    <div class="container ">

      <a class="navbar-brand d-flex align-items-center" href="index.html">
        <img src="logo.png" alt="Logo" height="30" class="me-2 ">
        <span class="fw-bold ">AIM</span>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mainNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="mainNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link " href="index.html">Home |</a></li>
          <li class="nav-item"><a class="nav-link" href="About Us.html">About Us |</a></li>
          <li class="nav-item"><a class="nav-link" href="Farmer.html">Farmer |</a></li>
          <li class="nav-item"><a class="nav-link" href="Government.html">Government |</a></li>
          <li class="nav-item"><a class="nav-link" href="Company.html">Company |</a></li>
          <li class="nav-item"><a class="nav-link" href="Researcher.html">Researcher |</a></li>
          <li class="nav-item"><a class="nav-link active" href="Analytics.html">Analytics |</a></li>
          <li class="nav-item"><a class="nav-link" href="questionnaire.html">Questionnaire |</a></li>
          <li class="nav-item"><a class="nav-link" href="funpage.html">Fun Page |</a></li>
          <li class="nav-item"><a class="nav-link" href="calculator.html">Calculate |</a></li>
            <li class="nav-item"><a class="nav-link" href="Contact Us.html">Contact Us</a></li>
        </ul>
      </div>
    </div>
  </nav>

    <div class="d-flex justify-content-center align-items-center py-4">
        <p class="analytics">Explore your analytics insights</p>
        <form class="search-box" onsubmit="return false;">
            <input type="search" class="form-control1" placeholder="Search reports, data, or insights...">
        </form>
    </div>

    <div class="alert alert-info fixed-alert shadow form-check">
        <label for="option1" id="alertMessage">Alert-messages: Loading data...</label>
    </div>

    <div class="container">
        <!-- KPI Cards -->
        <div class="row text-center mb-4">
            <div class="col-md-4 mb-3">
                <div class="card1 p-3">
                    <h6>Average Water Consumption</h6>
                    <p class="kpi" id="Average Water Consumption">0 L/day</p>
                    <small class="text-muted" id="totalFarmerEntries">0 farmer entries</small>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card1 p-3">
                    <h6>Excess Consumption Alerts</h6>
                    <p class="kpi" id="Excess Consumption Alerts">0 Alerts</p>
                    <small class="text-danger" id="%Excess Consumption Alerts">Threshold: 300L</small>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card1 p-3">
                    <h6>Total Companies</h6>
                    <p class="kpi" id="totalCompanies">0</p>
                    <small class="text-success" id="totalIrrigation">0 irrigation records</small>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="text-center mb-4">
            <button class="btn btn-custom2 m-2" onclick="_generateDetailedReport()">üìã Generate Full Report</button>
            <button class="btn btn-custom2 m-2" onclick="window.location.href='Farmer.html'">üåæ Go to Farmer Dashboard</button>
            <button class="btn btn-custom2 m-2" onclick="window.location.href='Company.html'">üè¢ Go to Company Dashboard</button>
        </div>

        <!-- Data Summary Tables -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card1 p-3">
                    <h6>Recent Farmer Entries</h6>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Farmer</th>
                                    <th>Water (L)</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody id="farmerSummaryTable">
                                <tr>
                                    <td colspan="3" class="text-center text-muted">No farmer data</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card1 p-3">
                    <h6>Company Irrigation Data</h6>
                    <div style="max-height: 300px; overflow-y: auto;">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Company</th>
                                    <th>Amount (m¬≥/min)</th>
                                    <th>Location</th>
                                </tr>
                            </thead>
                            <tbody id="companySummaryTable">
                                <tr>
                                    <td colspan="3" class="text-center text-muted">No company data</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Charts Placeholder -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="card1 p-3">
                    <h6>Water Usage Trend</h6>
                    <div class="chart-placeholder" id="usageTrend">
                        <div>
                            <p id="trendInfo">Collecting data...</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card1 p-3">
                    <h6>Top 5 High Consumption Farms</h6>
                    <div class="chart-placeholder" id="topConsumers">
                        <div id="topConsumersList">
                            <p>Analyzing data...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Statistics Overview -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card1 p-4">
                    <h5>üìä System Statistics Overview</h5>
                    <div class="row text-center">
                        <div class="col-md-3">
                            <p class="mb-1"><strong id="statTotalFarmers">0</strong></p>
                            <small class="text-muted">Total Farmers</small>
                        </div>
                        <div class="col-md-3">
                            <p class="mb-1"><strong id="statTotalWater">0 L</strong></p>
                            <small class="text-muted">Total Water Logged</small>
                        </div>
                        <div class="col-md-3">
                            <p class="mb-1"><strong id="statTotalCompanies">0</strong></p>
                            <small class="text-muted">Registered Companies</small>
                        </div>
                        <div class="col-md-3">
                            <p class="mb-1"><strong id="statHighUsage">0</strong></p>
                            <small class="text-muted">High Usage Alerts</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Education Section -->
        <div class="card1 p-4 mb-5">
            <h5>üíß Modern Irrigation Methods</h5>
            <p>
                Learn efficient irrigation techniques like drip and sprinkler systems that reduce 
                water waste. Monitor soil moisture regularly, and adopt smart sensors 
                for automated irrigation scheduling.
            </p>
        </div>
    </div>

    <!-- Educational Tips (Collapsible) -->
    <div class="container my-5">
        <div class="row text-center g-4">
            <div class="col-md-4">
                <div class="info-card p-3">
                    <button type="button" class="btn btn-custom w-100" data-bs-toggle="collapse" data-bs-target="#demo1">
                        üåÄ Problem: Traditional Irrigation
                    </button>
                    <div id="demo1" class="collapse mt-3">
                        <div class="collapse-content shadow-sm">
                            Many farmers still use old irrigation methods that waste water.
                            This causes over-irrigation, higher costs, and low water efficiency.
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="info-card p-3">
                    <button type="button" class="btn btn-custom w-100" data-bs-toggle="collapse" data-bs-target="#demo3">
                        üíß Drip and Sprinkler Systems
                    </button>
                    <div id="demo3" class="collapse mt-3">
                        <div class="collapse-content shadow-sm">
                            Modern systems like drip and sprinkler irrigation deliver water more evenly
                            and reduce water loss from evaporation or runoff.
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="info-card p-3">
                    <button type="button" class="btn btn-custom w-100" data-bs-toggle="collapse" data-bs-target="#demo5">
                        üìä Data Monitoring and Analytics
                    </button>
                    <div id="demo5" class="collapse mt-3">
                        <div class="collapse-content shadow-sm">
                            Web platforms, such as irrigation monitoring systems,
                            record and analyze water use. The data helps farmers,
                            researchers, and governments plan better.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row text-center g-4 mt-3">
            <div class="col-md-4">
                <div class="info-card p-3">
                    <button type="button" class="btn btn-custom w-100" data-bs-toggle="collapse" data-bs-target="#demo2">
                        üí° Need for Modern Solutions
                    </button>
                    <div id="demo2" class="collapse mt-3">
                        <div class="collapse-content shadow-sm">
                            To save water and improve productivity,
                            farmers must adopt modern and smart irrigation techniques
                            that match crop needs.
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="info-card p-3">
                    <button type="button" class="btn btn-custom w-100" data-bs-toggle="collapse" data-bs-target="#demo4">
                        üå± Smart Sensors and Automation
                    </button>
                    <div id="demo4" class="collapse mt-3">
                        <div class="collapse-content shadow-sm">
                            Soil moisture sensors and automatic controllers help monitor when
                            and how much to water. This avoids overuse and supports precision irrigation.
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="info-card p-3">
                    <button type="button" class="btn btn-custom w-100" data-bs-toggle="collapse" data-bs-target="#demo6">
                        üåç Water Efficiency and Sustainability
                    </button>
                    <div id="demo6" class="collapse mt-3">
                        <div class="collapse-content shadow-sm">
                            These technologies save water, protect groundwater,
                            and support sustainable agriculture in the long term.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row justify-content-center text-center mt-4">
            <div class="col-md-4">
                <div class="info-card p-3">
                    <button type="button" class="btn btn-custom w-100" data-bs-toggle="collapse" data-bs-target="#demo7">
                        üåæ Outcome: Improved Productivity
                    </button>
                    <div id="demo7" class="collapse mt-3">
                        <div class="collapse-content shadow-sm">
                            Smart irrigation increases crop yield, lowers water waste,
                            and supports national goals for food security and environmental balance.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <hr>
    <div class="text-white py-4" style="background-color: #1B3C53;">
        <div class="container">
            <p class="mb-2 mb-sm-0">@ 2025 AgriSense - All rights reserved.</p>
        </div>
    </div>

    <script src="samira.js"></script>
    <script>
        // Update Analytics Page with live data
        function updateAnalyticsPage() {
            // Load data from localStorage
            let farmerData = [];
            let companies = [];
            let irrigationData = [];

            try {
                const farmerStored = localStorage.getItem('farmerData');
                const companiesStored = localStorage.getItem('companies');
                const irrigationStored = localStorage.getItem('irrigationData');

                if (farmerStored) farmerData = JSON.parse(farmerStored);
                if (companiesStored) companies = JSON.parse(companiesStored);
                if (irrigationStored) irrigationData = JSON.parse(irrigationStored);
            } catch (e) {
                console.error("Error loading data:", e);
            }

            // Update KPI Cards
            updateKPIs(farmerData, companies, irrigationData);

            // Update Tables
            updateFarmerSummaryTable(farmerData);
            updateCompanySummaryTable(irrigationData);

            // Update Statistics
            updateSystemStats(farmerData, companies, irrigationData);

            // Update Charts Info
            updateChartsInfo(farmerData);

            // Update Alert Message
            let totalEntries = farmerData.length + companies.length + irrigationData.length;
            document.getElementById('alertMessage').textContent = 
                "Alert-messages: " + totalEntries + " total data entries recorded!";
        }

        function updateKPIs(farmerData, companies, irrigationData) {
            // Average Water Consumption
            if (farmerData.length > 0) {
                let totalWater = farmerData.reduce((sum, f) => sum + f.waterUsage, 0);
                let avgWater = (totalWater / farmerData.length).toFixed(2);
                document.getElementById('Average Water Consumption').textContent = avgWater + ' L/day';
                document.getElementById('totalFarmerEntries').textContent = farmerData.length + ' farmer entries';
            } else {
                document.getElementById('Average Water Consumption').textContent = '0 L/day';
                document.getElementById('totalFarmerEntries').textContent = '0 farmer entries';
            }

            // Excess Alerts
            let excessCount = farmerData.filter(f => f.waterUsage > 300).length;
            excessCount += irrigationData.filter(i => i.amount > 5).length;
            document.getElementById('Excess Consumption Alerts').textContent = excessCount + ' Alerts';

            // Total Companies
            document.getElementById('totalCompanies').textContent = companies.length;
            document.getElementById('totalIrrigation').textContent = irrigationData.length + ' irrigation records';
        }

        function updateFarmerSummaryTable(farmerData) {
            const tbody = document.getElementById('farmerSummaryTable');
            
            if (farmerData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="text-center text-muted">No farmer data</td></tr>';
                return;
            }

            tbody.innerHTML = '';
            const recent = farmerData.slice(-5).reverse();
            
            recent.forEach(farmer => {
                const row = document.createElement('tr');
                const isHigh = farmer.waterUsage > 300;
                row.innerHTML = `
                    <td>${farmer.name}</td>
                    <td class="${isHigh ? 'text-danger fw-bold' : ''}">${farmer.waterUsage.toFixed(2)}</td>
                    <td>${farmer.date}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateCompanySummaryTable(irrigationData) {
            const tbody = document.getElementById('companySummaryTable');
            
            if (irrigationData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="text-center text-muted">No company data</td></tr>';
                return;
            }

            tbody.innerHTML = '';
            const recent = irrigationData.slice(-5).reverse();
            
            recent.forEach(irr => {
                const row = document.createElement('tr');
                const isHigh = irr.amount > 5;
                row.innerHTML = `
                    <td>${irr.company}</td>
                    <td class="${isHigh ? 'text-danger fw-bold' : ''}">${irr.amount.toFixed(2)}</td>
                    <td>${irr.location}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateSystemStats(farmerData, companies, irrigationData) {
            document.getElementById('statTotalFarmers').textContent = farmerData.length;
            
            let totalWater = farmerData.reduce((sum, f) => sum + f.waterUsage, 0);
            document.getElementById('statTotalWater').textContent = totalWater.toFixed(2) + ' L';
            
            document.getElementById('statTotalCompanies').textContent = companies.length;
            
            let highUsage = farmerData.filter(f => f.waterUsage > 300).length;
            document.getElementById('statHighUsage').textContent = highUsage;
        }

        function updateChartsInfo(farmerData) {
            if (farmerData.length > 0) {
                let totalWater = farmerData.reduce((sum, f) => sum + f.waterUsage, 0);
                let avgWater = (totalWater / farmerData.length).toFixed(2);
                document.getElementById('trendInfo').innerHTML = 
                    `<strong>Total: ${totalWater.toFixed(2)} L</strong><br>Average: ${avgWater} L/entry<br>Entries: ${farmerData.length}`;
                
                // Top consumers
                let sorted = [...farmerData].sort((a, b) => b.waterUsage - a.waterUsage).slice(0, 5);
                let topList = '<ol class="text-start">';
                sorted.forEach(f => {
                    topList += `<li>${f.name}: <strong>${f.waterUsage.toFixed(2)} L</strong></li>`;
                });
                topList += '</ol>';
                document.getElementById('topConsumersList').innerHTML = topList;
            } else {
                document.getElementById('trendInfo').textContent = 'No data available yet';
                document.getElementById('topConsumersList').textContent = 'No data available yet';
            }
        }

        // Run on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateAnalyticsPage();
            
            // Auto-refresh every 2 seconds
            setInterval(updateAnalyticsPage, 2000);
        });
    </script>
</body>
</html>

